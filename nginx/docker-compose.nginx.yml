# Configuration Docker Compose pour Nginx avec SSL
# Utilisez ce fichier en complément de docker-compose.prod.yml
# ou intégrez-le dans votre docker-compose.prod.yml existant

services:
  nginx:
    image: nginx:alpine
    container_name: saarflex-nginx-prod
    ports:
      - "80:80"
      - "443:443"
    volumes:
      # Configuration principale
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      # Configuration du sous-domaine
      - ./nginx/api-saarflex.conf:/etc/nginx/conf.d/api-saarflex.conf:ro
      # Certificats SSL (Let's Encrypt)
      - /etc/letsencrypt:/etc/letsencrypt:ro
      # Certificats SSL personnalisés (si vous n'utilisez pas Let's Encrypt)
      # - ./nginx/ssl:/etc/nginx/ssl:ro
      # Répertoire pour les challenges Let's Encrypt
      - ./nginx/certbot/www:/var/www/certbot:ro
    depends_on:
      api:
        condition: service_healthy
    restart: unless-stopped
    networks:
      - saarflex-network

  # Service Certbot pour obtenir et renouveler les certificats SSL
  # Décommentez si vous utilisez Let's Encrypt
  # certbot:
  #   image: certbot/certbot
  #   container_name: saarflex-certbot
  #   volumes:
  #     - /etc/letsencrypt:/etc/letsencrypt
  #     - ./nginx/certbot/www:/var/www/certbot
  #   command: certonly --webroot --webroot-path=/var/www/certbot --email votre-email@example.com --agree-tos --no-eff-email -d api-saarflex.saarassurancesci.com
  #   restart: "no"

networks:
  saarflex-network:
    external: true

