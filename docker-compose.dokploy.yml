services:
  api:
    build:
      context: .
      target: production
    container_name: saarflex-api

    environment:
      - NODE_ENV=production
      - PORT=3000

    labels:
      - "traefik.enable=true"
      # On Ã©coute HTTP interne (Traefik = port 8080 sur host)
      - "traefik.http.routers.saarflex-api.rule=Host(`api-saarflex.saarassurancesci.com`)"
      - "traefik.http.routers.saarflex-api.entrypoints=web"  
      - "traefik.http.services.saarflex-api.loadbalancer.server.port=3000"

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 60s

    restart: unless-stopped

    volumes:
      - uploads:/app/uploads

volumes:
  uploads:
    driver: local
